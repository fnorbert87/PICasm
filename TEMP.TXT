	;command
	BANKSEL	BANK4
	MOVLW	0XAE
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X04
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X10
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X40
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X81
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X80
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XA1
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XA6
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XA8
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X1F
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XC8
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XD3
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X00
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XD5
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XF0
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XD8
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X05
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XD9
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XC2
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XDA
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X12
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XDB
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X08
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XAF
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XAF
	MOVWF	SSP1BUF
	CALL	SUBIF


*******************************

    	;STARTBIT
	BSF	SSP1CON2,SEN
	CALL	STOPIF

	BANKSEL	BANK4
	MOVLW	0X79
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X00
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XAE
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XD5
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X80
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XA8
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X3F
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XD3
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X00
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X40
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X8D
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X14
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XA1
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XC0
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XDA
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X12
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X81
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XCF
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XD9
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XF1
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XDB
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X40
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XA4
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XA6
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X20
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X00
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XAF
	MOVWF	SSP1BUF
	CALL	SUBIF

	;STOPBIT
	BANKSEL	BANK4
	BSF	SSP1CON2,PEN
	CALL	STOPIF


	;STARTBIT
	BSF	SSP1CON2,SEN
	CALL	STOPIF

	BANKSEL	BANK4
	MOVLW	0X79
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X00
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X10
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X40
	MOVWF	SSP1BUF
	CALL	SUBIF

	;STOPBIT
	BANKSEL	BANK4
	BSF	SSP1CON2,PEN
	CALL	STOPIF


	;STARTBIT
	BSF	SSP1CON2,SEN
	CALL	STOPIF

	BANKSEL	BANK4
	MOVLW	0X79
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0X40
	MOVWF	SSP1BUF
	CALL	SUBIF

	BANKSEL	BANK4
	MOVLW	0XEE
	MOVWF	SSP1BUF
	CALL	SUBIF

	;STOPBIT
	BANKSEL	BANK4
	BSF	SSP1CON2,PEN
	CALL	STOPIF



		;ACK ellenőrzés
ACKIF	NOP
	BANKSEL	BANK0
SUBLOOP2	BTFSS	PIR1,SSP1IF
	GOTO	SUBLOOP2
	BCF	PIR1,SSP1IF
	NOP
	BANKSEL	BANK4
	BTFSS	SSP1CON2,ACKSTAT
	CALL	BSFRA4
	NOP
	BANKSEL	BANK4
	BTFSC	SSP1CON2,ACKSTAT
	CALL	BSFRA0
	RETURN

	;megszakításra várakozás
SUBIF	NOP
	BANKSEL	BANK4
SUBLOOP	BTFSS	PIR1,SSP1IF
	GOTO	SUBLOOP
	BCF	PIR1,SSP1IF
	RETURN

BSFRA0	NOP
	BANKSEL	BANK0
	BSF	PORTA,RA0
	RETURN

BSFRA4	NOP
	BANKSEL	BANK0
	BSF	PORTA,RA4
	RETURN
	