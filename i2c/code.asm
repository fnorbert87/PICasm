	list p=12LF1822 
 
 	include	"p12lf1822.inc"
 	__config  _CONFIG1, 0x3F84
	__config  _CONFIG2, 0x1613
 
	#define BANK0 0x000
	#define BANK1 0x080
	#define BANK2 0x100
	#define BANK3 0x180
	#define BANK4 0x200
	#define BANK5 0x280
	#define BANK6 0x300
	#define BANK7 0x380

	BANKSEL	BANK0

	CBLOCK	0x20
		d1, d2, d3
	ENDC

	ORG	0X0000

	BANKSEL	BANK1

	MOVLW	0XF0
	MOVWF	OSCCON
	MOVLW	b'00000110'
	MOVWF	TRISA

	BANKSEL	BANK3

	CLRF	ANSELA


	BANKSEL	BANK0

	CLRF	PORTA

	BANKSEL	BANK2

	CLRF	LATA

	;I2C init
	BANKSEL	BANK4
	MOVLW	0X28
	MOVWF	SSP1CON1
	MOVLW	0X00
	MOVWF	SSP1CON2
	MOVLW	0X13 	;400Khz / 32Mhz
	MOVWF	SSP1ADD
	MOVLW	0X00
	MOVWF	SSP1STAT

MLOOP	NOP
	BANKSEL	BANK0
	CALL 	delay1s	
	BCF	PORTA, 0
	NOP
	BCF	PORTA, 5
	CALL 	delay1s	
	
	CALL	I2CBEGIN


	MOVLW	0XD0
	CALL	I2CWRITE
	CALL	I2CACK

	CALL	I2CEND

	GOTO	MLOOP


;****************** SUBRUTINS ********************

	;I2C BEGIN
I2CBEGIN	CALL	I2CHOLD
	BSF	SSP1CON2,SEN
	RETURN

	;I2C WRITE
I2CWRITE	CALL	I2CHOLD
	MOVWF	SSP1BUF
	RETURN

I2CACK	CALL	I2CHOLD

	BANKSEL	BANK4
	BTFSS	SSP1CON2, ACKSTAT
	GOTO	GREEN
	GOTO	RED
RED	NOP
	BANKSEL	BANK0
	BSF	PORTA, RA0
	GOTO	RET
GREEN	NOP
	BANKSEL	BANK0
	BSF	PORTA, RA5
RET	RETURN

	;I2C END
I2CEND	CALL	I2CHOLD
	BSF	SSP1CON2,PEN
	RETURN

	;I2C HOLD
I2CHOLD	NOP
	BANKSEL	BANK4
LOOP	BTFSC	SSP1STAT,2
	GOTO	LOOP
LOOP2	BCF	STATUS, Z
	MOVLW	B'00011111'
	ANDWF	SSP1CON2,0
	BTFSS	STATUS, Z
	GOTO	LOOP2
	RETURN

	
	include	"../includes/delay1s.inc"

	END